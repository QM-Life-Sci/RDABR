---
title: 'Problem Set 05'
author: "Your Name Here"
date: 'Last updated: `r Sys.Date()`'
output:
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
---

```{r}
#| label: setup
#| message: false
#| warning: false

library(tidyverse)

theme_set(theme_classic())
```


## Stalk-eyed flies

Stalk-eyed flies are a group of flies whose eyes are at the ends of long projections ("stalks") on either side of their head. Shortly after emerging from the pupa, these flies ingest air through their mouth and pump it into these stalks to elongate them ([watch this amazing process here](https://www.youtube.com/watch?v=ZGdfIX5x8XM){target="_blank"}). 

Females prefer males with wider eye spans. See the photo below:

![](https://i.imgur.com/7KxZKQF.jpg){fig-align="center" fig-alt="Photograph of a stalk-eyed fly."}

The `Stalkies.csv` data file contains data for an experiment in which male stalk-eyed flies (*Cyrtodiopsis dalmanni*) were reared on different food sources (`food_source`: corn and cotton). The distance between the eyes in millimeters is recorded as `eye_span`.^[David, P., T. Bjorksten, K. Fowler, and A. Pomiankowski. 2000. Condition-dependent signalling of genetic variation in stalk-eyed flies. *Nature* 406: 186-188.]

The hypothesis is that food type affects eye span. In this exercise, you will try to answer this question.

### Activity

Load the `Stalkies.csv` file and explicitly mutate `food_source` into a factor. Examine the columns of data it contains.

```{r}


```

Visualize the data set in two different ways by making two different plots:

1. Make a boxplot showing each food type on the x-axis using `geom_boxplot()`. We haven't gone over boxplots, but here is a website with a good overview: [https://www.atlassian.com/data/charts/box-plot-complete-guide](https://www.atlassian.com/data/charts/box-plot-complete-guide){target="_blank"}. See if you can set up the boxplot so that the food source is on the x-axis and eye span on the y-axis.
2. Plot the raw data (points) for the two groups.
    - For the points, include jitter and transparency.
    - Include a point for the means and error bars standard errors of the mean plotted in a different color (the code in Lecture 05-1 "Plot raw data with summary stats" will help you).
    - Try a few different values for each of these elements (jitter, color, transparency) to find a plot you feel best communicates the structure of the data. You will find that the number of data points you have will affect how much jitter & transparency is most appropriate.
    - Change the axis labels to what you would expect to find on a publication ready figure.

```{r}


```

Describe the distributions within each group and between groups. What do these plots tell you? Do you have a prediction for what your statistical tests will show? How does the information provided by the boxplot differ from the information conveyed by the second plot.

> 



#### Summary statistics

For each food source calculate: the number of observations, mean, standard deviation, variance, and standard error of the mean.

Use `group_by()` and `summarize()` as we have seen in the lecture slides. Remember that there is no SEM function built-in with R. Copy the function from the lecture slides and use it here.

```{r}


```

How do the number of observations, mean, standard deviation, variance, and SEM compare? Do they match your intuition above?

> 



#### Intervals

Calculate approximate 95% confidence intervals for the mean eye span for each group. You can either do the calculations step-by-step as we did for the gliding snakes example or using `group_by()` and `summarize()` like we did for the horned lizard example.

```{r}


```

What are the approximate 95% confidence intervals for the mean eye span for flies raised on corn and cotton? What is your hypothesis for whether the means differ or not? How confident are you in your hypothesis?

> 


#### Tests of means

Finally we can fit the linear model where eye span is modeled by food source.

`lm()` is a general function that fits many many different kinds of linear models. We will use `lm()` almost exclusively in the coming units.

1. Fit a linear model using `lm()` where `eye_span` is modeled by `food_source` and assign this to an object.
2. Pass the object that you just created to the function `summary()` to generate the model summary.

```{r}


```

Examine the coefficients in the model summary. Try to reconcile the values in the `Estimate` column for the rows: `(Intercept)` and `food_sourceCotton` with the means you calculated above.

> 



We will investigate the other parts of this summary in the coming units. Next, we will use a *t*-test to estimate the difference in means in the two treatments.

By default, the `t.test` function will perform a test that *does not* assume equal variances (called "Welch's Correction"). You may specify equal variances with `var.equal = TRUE`, *if you decide that is appropriate here*. Refer back to to the summaries (mean, sd, variance) you calculated above.

Perform a *t*-test using the formula method to specify the groups to test. The formula will be identical to the formula for `lm()`. Print the results.

```{r}


```

Study the printed output of `t.test()`. Do you find the means for the Corn and Cotton groups? Do these match your calculation above?

> 



`t.test()` is a function that performs a very specific task: carrying out a *t*-test (by default with Welch's correction for unequal variances). A *t*-test is just a special kind of linear model (1 categorical predictor with 2 levels), so we can also fit the same model using `lm()`. There are a few different kinds of *t*-test that you can do with `t.test()`, but all of them are just specific kinds of linear models.


#### “Linear” Models

When we learned about OLS regression, the interpretation of the slope was "how much does the outcome variable (y) change for a 1 unit increase in the predictor (x)". We used `lm()` to fit those OLS models, and we just used `lm()` to fit a model comparing means (and showed how that it also equivalent to a *t*-test).

How can we use the same function to do these two different tasks? In this exercise, we'll look under the hood a bit to see what is happening internally when you ask R to fit a linear model with a categorical variable (factor).

Start by examining the different values for `food_source` with `levels()`. This function prints the values for a factor. Run `levels()` on the variable `food_source`. It's easiest to use the `$` notation, for example `levels(stalk$food_source)` (where `stalk` is the name of the tibble holding the values).

```{r}


```

The order in which the levels are printed is the default order for determining what is the base level (i.e., Intercept) for the comparison.

What is the base level? Relate this to the summary table you created above.

> 



The function `ifelse()` (and it's tidyverse counterpart `if_else()`, which are largely interchangeable) is useful for doing conditional assignment to a variable. It takes the general form: `ifelse(test, yes, no)`.

The `test` parameter is an equality or inequality (==, <, >, etc.) which returns a `TRUE` or `FALSE`. For each element, if the result is TRUE, the value at `yes` is returned. If the result is FALSE, the value at `no` is returned. Study the following examples, and try out some other `iflese`s.

```{r}
x <- 1:10
x <- ifelse(x <= 5, 1, 10)
x

y <- 1:10
y <- ifelse(y <= 5, y + 3, y^2)
y
```

Next we want to create a new column in the stalk-eyed flies data that has 0 where `food_source == "Corn"` and 1 if it is not. Use `mutate()` to create this column. Call the column `food01`. Verify that the column was created correctly (Corn should be 0 and Cotton 1).

```{r}


```

Fit a linear model where `eye_span` is predicted by `food01`. Remember that an intercept is assumed by default (equivalent to `+ 1`). Assign the model to an object and print out the summary.

```{r}


```

What values do you find for `(Intercept)` and `food01`? Compare these values to the parameter estimates in your original linear model with `food_source` as a categorical variable. Also compare the other values in the summary (standard errors, etc.).

> 


The conversion from factors to 0 and 1 is carried out automatically when you use `lm()` with factors. Internally, the variable is converted to 0 and 1. Additionally, a column of all 1s is created for the intercept. Later in the course we will see how R uses 0 and 1 to encode factors with more than 2 levels.

The idea of adding *linear* combinations of either continuous or categorical variables is where the name "linear model" comes from. Later we will see how this idea can be extended to include any combination of any number of continuous and categorical predictors.
